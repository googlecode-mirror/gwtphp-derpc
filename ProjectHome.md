# Introduction #

**GwtPhp-deRPC** is a PHP port for the new version of GWT RPC called Direct-Eval RPC (deRPC). This new version, deRPC, is faster than the first one but generates more data to transfer. In production mode, it generates directly JavaScript and allow the internet browser to parse it quickly.

The main advantages of **GwtPhp-deRPC** are :
  * minor modification to do in java side
  * all the classes used in service will be generated in php
  * the php service is easy to write

Main Features :
  * all basic types (int, String, byte, char... , Integer, String, Byte, Character...)
  * Array is supported
  * enums are supported
  * enclosing types are supported
  * Collection, List, Set and Map are supported
  * Date (no Time)

It requires minimum **PHP 5.3** to run.

# Example #
## Java side ##
#### Module ####

To add the **GwtPhp-deRpc** module to your project, add these lines in your gwt.xml file :

```
<inherits name=’com.didactilab.gwt.phprpc.PhpDeRpc’ />
<public path=’phpservice’ />
```

  * The first line will indicate your project module to use the GwtPhp-deRpc module.
  * The second line will add your php service file to the public path.

#### RPC Service ####

The java service files are very similar to those you would write to use the GWT RPC. Two exceptions :
  * Instead of extending the `RemoteService` interface, use the `PhpService` instead.
  * Use the annotation `@PhpRemoteServiceRelativePath` to locate the path of your php service. This path is used for generating the php files.

Like GWT RPC, it is necessary to have two java service files : the main one, and the async one.

##### MyService.java #####
```
import com.didactilab.gwt.phprpc.client.PhpRemoteServiceRelativePath;
import com.didactilab.gwt.phprpc.client.PhpService;

@PhpRemoteServiceRelativePath("phpservice")
public interface MyService extends PhpService {
     boolean myFirstCall(int param);
     MyObject callWithObjectAndListParams(MyObject param1, ArrayList<String> param2);
}
```

##### MyServiceAsync.java #####
```
import com.google.gwt.user.client.rpc.AsyncCallback;

public interface MyServiceAsync {
     void myFirstCall(int param, AsyncCallback<Boolean> callback);
     void callWithObjectAndListParams(MyObject param1, ArrayList<String> param2, AsyncCallback<MyObject> callback);
}
```

##### MyObject.java #####
```
public class MyObject implements Serializable {
     public int age;
     public String[] names;
     public double weight;
     public HashMap<String, Integer> other;
}
```

#### In your code ####

Use the service in the same way as you use GWT RPC service.

```
{
     MyServiceAsync service = GWT.create(MyService.class);
     // use service.myFirstCall(...)
     // use service.callWithObjectAndListParams(...)
}
```

## PHP side ##
#### PHP service ####

An example of this service is generated by PhpDeRpc during the first execution of the project with the name `MyService.model.php`.

The class in the php service file must extends `RemoteService`. The file must be in the directory indicated with the `@PhpRemoteServiceRelativePath` java annotation.

```
<?php 

/** @gwtname com.mycomp.gwt.mysample.client.service.MyService */
class MyService implements RemoteService {

     /** 
      * @param int $param
      * @return boolean 
      */
     public function myFirstCall($param) {
          //...
     }

     /** 
      * @param MyObject $param1
      * @param ArrayList<String> $param2
      * @return MyObject 
      */
     public function callWithObjectAndListParams($param1, $param2) {
          // ...
          $obj = new MyObject();
          // ...
          $param1->age = 25;
          // ...
          foreach ($param2 as $str) {}
          // ...
          return $obj;
     }

}

?>
```

As you can see, we use `MyObject` like a php object. In fact, a PHP version of `MyObject` has been generated by GWT.

#### PHP generated files ####

These files are generated during the compilation.

##### MyService.model.php #####

This java file is a model of the php service file.
```
<?php

/** @gwtname com.mycomp.gwt.mysample.client.service.MyService */
class MyService implements RemoteService {

     /** 
      * @param int param
      * @return boolean 
      */
     public function myFirstCall($param) {

     }

     /** 
      * @param MyObject $param1
      * @param ArrayList<String> $param2
      * @return MyObject 
      */
     public function callWithObjectAndListParams($param1, $param2) {

     }
}
?>
```

##### MyObject.php #####

This is the php file containing the php MyObject definition of java object.
```
<?php

/** @gwtname com.mycomp.gwt.mysample.client.service.MyObject */
class MyObject implements IsSerializable {
     /** @var int */
     public $age;

     /** @var string[] */
     public $names;

     /** @var double */
     public $weight;

     /** @var HashMap<string> */
     public $other;
}
?>
```

# What's new #

  * `Collection`, `List` (`GenericList` in php), `Deque`, `Queue`, `Stack`, `Set`, `Map`, `SortedMap`,  `ArrayList`, `LinkedList`, `HashSet`, `HashMap`, `TreeMap`, `Vector`
  * `Collections.sort`, `Collections.unmodifiableX`(..)
  * PhpRpc that use standard GWT mechanism of RPC. It is in alpha version. Not for production.